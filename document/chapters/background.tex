
\chapter{Background}
\section{Geodetic Reference Systems for Ocean Observation}
\pdfcomment{Maybe incorporate this into an appendix about geophysics?}
\subsection{The Geoid}
\pdfcomment{split into more subsections}
The geoid is defined as a level surface of that is normal to the gravitational acceleration at every point. It is not exactly the surface of equal gravitational potential, but it also includes the centrifugal force due to a fixed local reference frame. The potential field is based defining the gravitation accelration as the gradient of a potential field $W$ $g=\Delta W$, and the geoid is a level surface in this field. If the ocean were in static equilibrium, the free surface settle along this surface. 

The contours of the geoid can be measured using satellite gravimetry, and from these measurements the geoid can be mathematically approximated as a sum of a series of spherical harmonic functions.

The surface of the geoid changes with time due to deformation of the earth. These \emph{earth tides} are periodic, but their time average is non-zero. For satellite altimetry, a reference system that changes with time can be inconvenient, so measured heights are often reported in a coordinate system that is referenced to the \emph{tide-free geoid}. The tide-free geoid is a theoretical reference surface that removes both the periodic effect of earth tides, and the time-average of the earth tides (the permanent tide). It can be thought of as a system where the distance to the sun and moon is increased to infinity.  

\begin{figure}[h!]
      \centering
      \includegraphics[width=\textwidth]{figures/Meantide_vs_tide_free_comparison_doc.png}
      \caption{Relative levels of the reference planes}
      \label{fig:geoids-ellipsoids-graphics}
\end{figure}

\ref{fig:geoids-ellipsoids-graphics} shows the various reference systems used in calculating the height of an individual photon in the ICESat-2 data production. The location of the satellite is resolved in ellipsoidal coordinates using the precision Orbit Determination Module. Then, using the travel time between the photon and the satellite, the location of the photon is calculated using the speed of light and corrections for atmospheric delays, instrument bias, and wave height. The height of the photon above the ellipsoid is calculated by the difference:


\begin{equation}\label{eq:raw_photon_calculation}
      H_{satellite_{surface}} = c(t_T-t_R)/2
\end{equation}
\begin{equation}
      H_p = H_{satellite_{ellipsoid}} - H_{satellite_{surface}}
\end{equation}
Where:
\begin{itemize}
      \item $H_{photon}$ is the height of the photon above the ellipsoid
      \item $H_{satellite_{ellipsoid}}$ is the height of the satellite above the ellipsoid (the brown line in figure \ref{fig:geoids-ellipsoids-graphics})
      \item $H_{satellite_{surface}}$ is the height of the satellite above the surface (the green line in \ref{fig:geoids-ellipsoids-graphics})
      \item $c$ is the speed of light
      \item $t_T$ and $t_R$ are the photon transmit and receive times respectively
\end{itemize}


\subsection{Tide-free geoid}

\subsubsection*{temp notes}
\begin{itemize}
      \item The geoid is the theoretical surface of even gravitational acceleration. It is where the ocean would settle if there were no waves and currents \parencite{Hughes2008}
      \item difference between the geoid and the current surface is called \emph{dynamic topography} \parencite{Hughes2008}
      \item large scale shape of the geoid can be approximated with an ellipsoid with an equatorial radius 21.4km longer than the polar radius \parencite{Hughes2008}. This is called the reference ellipsoid.
      \item GPS heights are reported relative to a reference ellipsoid \parencite{}
      \item gravitational force is the gradient of the potential: $g = \nabla W$, and the geoid is a surface with constant W \parencite{Hughes2008}
      \item tide-free geoid is good for 3D positioning because the coordinates don't change with time
      \item Relates the frequency of clocks to potential $\frac{df}{f} = -\frac{dW}{c^2}$ (not sure I can work this into the thesis document but it is interesting)
      \item Tide-free removes the periodic effects, and permanent effects caused by the nonzero time average of the perioidic effects \parencite{Escapa2020}
      \item 
\end{itemize}


\subsection{Permanent Tide}
The same gravitational forcing that drives ocean tides also creates a deformation of the earth itself. Because the time average of the sun and moon's tidal effect on the earth is nonzero, the mean effect of the solid earth tides is also non-zero. This time-averaged deformation is referred to as the permanent tide (n.b. here `tide` refers to earth tide rather than ocean tides).

The \emph{tide-free geoid} is defined as a reference system where the permanent tide effect is removed \parencite{Makinen2009}.


\subsection{Inverted barometer effect}
Inverted barometer is the effect of air pressure on the ocean height (i.e. local dynamic sea-surface topography)\parencite{comparison guide}\pdfcomment{find a published reference for this}. Spatial gradients in air pressure caused by weather (high and low pressure systems) are equalized by gradients in the water surface height. NASA includes a factor to remove this effect from the local sea surface. 

\subsection{Dynamic Atmosphere Correction}
In additional to surface height changes due to atmospheric pressure forcing, the local wind stress field also creates gradients in the sea surface height due to water mass momentum forcing. These variations are very high frequency, 

The ICESat-2 ATL03 data includes a correction factor for that includes the effects of both wind and the atmospheric pressure. It is calculated from the MOG2D model \parencite{LeProvost1994}, which is provided by AVISO. It has a 6 hour temporal resolution and a $0.25^{\circ}$ horizontal resolution, and is interpolated spatially and temporally for inclusion in the ATL03 data. 

\subsection{Ocean Tides}

\pdfcomment{This should maybe be moved into the ICESat-2 section}


The ocean tides contribute 70\% of the variance to the sea surface \parencite{icesat2 comparison guide}.


\section{Lidar Bathymetric surveying}

The earliest attempts to use Light Detecting and Ranging (lidar) to survey the coastal zone date back to the late 1960s. \parencite{Bailly2016}. The technology has matured significantly since then and currently airborne lidar using a strong 532nm laser beam is a common technique for high accuracy bathymetric and topographic surveying. The downside of this technique is that it does not scale well to large areas, because of the expensive equipment, and extensive post-processing work to correct for refraction of the laser beam in the water column, calibration to in situ data, and outlier detection.

Recent advances in lidar technology have allowed the development of the photon-counting lidar, which requires significantly less energy to detect a return signal. These have allowed the practical application of constant lidar data collection in satellites. The use of spaceborne lidar is a more recent area of research, but some early results have shown that spaceborne lidar can find depths as deep as 40m \parencite{Parrish2019}.

The potential for bathymetric mapping using spaceborne laser observations has been noted since before the advent of the ICESat-2 mission. The predecessor mission carried a lidar instrument called the Geoscience Laser Altimeter System (GLAS). GLAS was a green-light laser intended for measuring atmospheric aerosols \parencite{Abshire2005}. However, because of the laser architecture, GLAS was not able to penetrate the water column \parencite{Forfinski-Sarkozi2016}. However, a prototype of ATLAS, called the Multiple Altimeter Beam Experimental lidar (MABEL) instrument was tested with high-altitude aircraft missions, allowing a simulation of the data that would be provided by ATLAS \parencite{Mcgill2013}. Early experiments with MABEL showed good agreement between bathymetric measurements from MABEL and high-quality airborne reference data \parencite{Jasinski2016,Forfinski-Sarkozi2016}.


\section{ICESat-2}

The ICESat-2 mission is intended to gather high resolution topographic data on a global scale. The satellite carries the Advanced Topographic Laser Altimeter System (ATLAS). ATLAS is a highly sensitive photon-counting, green-light lidar. The satellite instrument points at reference ground tracks (RGT) along the earth's surface, and returns with a repeat time of 91 days. Along the reference track, there are 3 beams, one pointing directly at the reference track, and two that are offset by approximately 3km on either side. The layout of the beams relative to the RGT are shown in figure \ref{fig:icesat-rgts}.

\begin{figure}[h!]
      \centering
      \includegraphics[width=0.5\textwidth]{./figures/ATLAS_beam_layout_from_user_guide.png}
      \caption{Layout of the ICESat-2 beams}
      \label{fig:icesat-rgts}
\end{figure}

Each of the 3 beams emits both a strong and weak beam, with the strong beam being approximately 4x more powerful \parencite{Neumann2019d}. Of the approximately \(10^{14}\) of photons emitted per pulse, up to  10 make it back to the sensor and are detected \parencite{Neumann2019d}. The exact number of emitted photons that are subsequently detected at the sensor depends on the local atmospheric conditions and the reflectivity of the surface \parencite{Neumann2019e}. The highly sensitive instrument also receives significant noise, due to atmospheric scattering and photons from the sun.

\begin{figure}[htbp]
      \centering
      \includegraphics{./figures/3d_beam_view_from_atl03ATBD.png}
      \caption{The layout of the ICESat-2 beams in 3D space. from \cite{Neumann2019d}}
      \label{3d-beams}
\end{figure}


The main mission of the satellite is to gather data about mass and elevation changes in ice sheets and glaciers, and to study global global canopy height \parencite{Markus2017}. As part of the vegetation height mission, the observatory is sometimes pointed away from the reference ground track when flying over land. This increases the spatial density of the observations of vegetation height \parencite{Markus2017}. This operation, called  \emph{offpointing}, begins before the satellite begins to record data over land, so the nearshore coastal area is also included, and therefore bathymetric and hydrological applications also benefit from increased spatial coverage \parencite{Magruder2021}.

To locate the position of each photon in 3D space, the time of flight of the photon is calculated with a precision of 800 ps \parencite{Neumann2019d}. The location of the center of mass of the instrument is found using Global Positioning System (GPS) systems onboard the satellite. By combining the measured time of flight and satellite position, the geolocation of each returning photon is calculated \parencite{Neumann2019d}.

\subsection{Weak vs. Strong Beams}

The beams are divided into weak and strong signals to enhance the radiometric dynamic range. The strong beams are expected to provide better signal-noise ratios over low-reflectivity surfaces, like the ocean and seafloor \parencite{Neumann2019d}. The weak beams are better for capturing very high reflectivity surfaces like ice, which might otherwise saturate the sensor and do not provide usable measurements. The strong beams have been found to provide the better data for lidar bathymetry measurements, but there weak beams can still contain useful bathymetry data \parencite{add citation}. 

\subsection{Refraction Correction}
\pdfcomment{Make a figure with refraction correction amount on the x axis, depth on the y, and then multiple lines for different pointing vectors}
The locations calculated by the data products from the satellite do not correct of the refraction induced by the different speeds and which light travels in water and in the atmosphere. This effect introduces both a horizontal and vertical error in the photon location, as shown in figure \ref{refract-image}.

\begin{figure}[ht]
      \centering
      \includegraphics[width = 0.5\textwidth]{figures/refraction_error.png}
      \caption{The errors caused by the refraction at the air-water interface}
      \label{refract-image}
\end{figure}

When the instrument is pointed directly at the RGT, the laser beams point nearly directly at the satellite's nadir. When directly on-nadir, the additional horizontal error induced by refraction is approximately 9cm \parencite{Parrish2019}, which for bathymetric purposes is negligible. However, by design ATLAS is capable of pointing up to $5 \degree$ off-nadir (equal to 43km away from the RGT \parencite{Magruder2021}). During offpointing, the horizontal error is much more significant and must be corrected for measurement accuracy \parencite{Parrish2019}.\citeauthor{Parrish2019} propose an method to correct for both horizontal and vertical error that is widely cited in future research. The Parrish method assumes a flat water surface, but other studies have extended their method to include the effect of water slope or wave action on the refraction error \parencite{Ma2020,Zhang2022}. Some studies only use data that is collected when the instrument is pointing on-nadir, and therefore only correct for the vertical error using Snell's law. This is referred to as \emph{first order} refraction correction in the summary table.

\begin{equation}
      \theta_2 = \sin^{-1}{\frac{n_1 \sin{\theta_1}}{n_2}}
\end{equation}

\begin{equation}
      R = \frac{S n_1}{n_2}
\end{equation}

\begin{equation}
      S = \frac{D}{\cos{\theta_1}}
\end{equation}

\begin{equation}
      \gamma = \frac{\pi}{2} - \theta_1
\end{equation}

\begin{equation}
      \alpha = \sin^{-1}{\frac{R \sin{\phi}}{P}}
\end{equation}

\begin{equation}
      P = \sqrt{R^2 + S^2 - 2RS \cos{(\theta_1 - \theta_2)}}
\end{equation}

\begin{equation}
      \beta = \gamma - \alpha
\end{equation}

\begin{align}
      \Delta Y &= P \cos{\beta} \\
      \Delta Z &= P \sin{\beta} \\
      \Delta E &= \Delta Y \sin{\kappa} \\
      \Delta N &= \Delta Y \cos{\kappa}
\end{align}

\subsection{Vertical Height Reference}

The ATL03 data product reports the photon heights relative to the WGS84 reference ellipsoid. These ellipsoidal heights already include corrections for the solid earth tides, ocean loading, ocean pole tides, and atmospheric delays.

The height provided in the ATL03 data product is calculated by the following equation:

\[H_{GC} =  H_{P} - H_{OPT} - H_{OL} - H_{SEPT} - H_{SET} - H_{TCA}\]

Where:

\begin{itemize}

      \item \(H_{GC}\) is the geophysically corrected photon height above the WGS84 ellipsoid
      \item \(H_{P}\) is the uncorrected photon height above the WGS84 ellipsoid, from equation \ref{eq:raw_photon_calculation} 
      \item \(H_{OPT}\) is the height of the ocean pole tide correction, which is the deformation at the poles induces by centrifugal effects of variations in the earth's rotational axis.
      \item \(H_{OL}\) is the height of the ocean loading tide, which is the deformation of earth's crust due to the weight of ocean tides
      \item \(H_{SEPT}\) is the height of the solid earth pole tide
      \item \(H_{SET}\) is the solid earth tide, the deformation of the earth's crust due to the gravitational effects of the sun and the moon
      \item \(H_{TCA}\) is the height of the total column atmospheric delay, which is the effect of atmospheric conditions the photon travel time.
\end{itemize}

$H_{GC}$ is the height above the WGS84 ellipsoid. To convert this ellipsoidal height into a value that can be used for computing the bathymetry, it needs to be converted into an instantaneous sea surface height. The equation that relates these is:
\pdfcomment{This isn't entirely right I think. Don't need to convert before kde}
\begin{equation}
      H_{inst} = H_{GC} + H_{geoid} + H_{free2mean} + H_{DAC}
\end{equation}

Where:
\begin{itemize}
      \item $H_{geoid}$ is the height of the tide-free geoid above the reference ellipsoid
      \item $H_{free2mean}$ is the difference between the tide-free and the mean-tide geoid
      \item $H_{DAC}$ is the dynamic atmospheric correction factor which includes periodic effects like local wind loading \pdfcomment{expand on this a bit}
      \item 
\end{itemize}

The elevation value reported in ATL03 does not include the geoid or any tides. To find these values from the reported ellipsoidal height, the dataset includes correction factors for the tide-free geoid, the height difference between the tide-free and mean-tide geoid, and the height of the tide relative to the mean tide geoid as calculated by the GOT4.8 model. The mean sea level can be estimated by adding these correction factors to the ellipsoidal height. However, the GOT4.8 model tidal height is a based on a relatively low resolution grid, and therefore is less accurate in nearshore coastal areas and within embayments \parencite{Neumann2019e}. Therefore, it is proposed to use the data from the operational runs of the Global Tide and Surge Model (GTSM) \parencite{Buckman2015}, developed by Deltares, to convert the mean tide geoid elevation to the water depth at the date and time of the satellite pass.

\subsection{Signal Photon Identification}
\label{subsec:denoising}
The ATL03 data product includes a calculated confidence that a given photon return is signal or noise. The probability is assigned for each of the 5 surface types. Because bathymetric survey was not part of the original mission scope, there is no official classification for subsurface returns. Therefore within the default classification bathymetric photons are often classified as noise. However, the classification of ocean surface classification is reliable \parencite{} \pdfcomment{add reference here - need to find all icesat papers and search each one to figure out where I read this} and can be used to filter out points at or above the sea surface. 

To find bathymetric signal, a separate algorithm specifically calibrated to distinguish bathymetric signal from noise photons is applied to this data. There are several different techniques proposed in the literature.  Some early research on small sites used manual classification \parencite{Forfinski-Sarkozi2016}. Other researchers have used implementations of the density-based spatial clustering for applications with Noise (DBSCAN) algorithm \parencite{Ester1996}, with parameters that are set adaptively based on the local density of returns. These density-based methods are premised on the assumption that signal photons are closer together than noise photons. \parencite{Neuenschwander2019}.


\section{Satellite Derived bathymetry}
There are several established methods for calculating bathymetric data from passive optical and SAR satellite data, and recent advances in cloud computing capabilities like Google Earth Engine (GEE) \parencite{Gorelick2017a} make large catalogs of remote sensing data more accessible \parencite{Pike2019,Turner2021}. The approaches can be broadly classified into \emph{wave-kinematic} and \emph{optical inversion} techniques.

\subsection{Wave-Kinematic Bathymetry}
This approach uses the hydrodynamic properties of a wave field to estimate the bathymetry. The hydrodynamic variables like wave celerity and wave length are estimated from either optical or SAR satellite data. The bathymetry can then be calculated using the wave dispersion relation \cite{Almar2021e}. The major advantage of this method is that the results do not depend on the turbidity, which can be a significant limitation to optical SDB along many coastlines. The downsides to this approach are that the horizontal resolution is limited compared to optical methods, and the depth that it can reach is limited by the wavelength: longer waves feel the bottom earlier, so only in areas with significant swells can deeper bathymetry measurements be found \parencite{Almar2021e}.

\subsection{Bathymetry from Optical Remote Sensing}
Optical remote sensing is a passive technique, as it detects light from the sun reflected by the earth. Since the 1970s many methods of estimating bathymetry based on the optical quality of the water have been found, all based on the physical principle that water attenuates light. Optical methods require to the water to be \emph{optically shallow}, or clear enough that light can reach the sea floor. This is a significant restriction, but in places where it is applicable it gives very high resolution data of the seafloor. There are two broad types of algorithms for extracting bathymetric data from optical satellite imagery, analytical and empirical. Empirical models link the amount of attenuation of each pixel to in-situ depth measurements, and derive a relationship between color and depth. One advantage is that they are generally computationally inexpensive. Analytical or physics-based approaches require corrections for atmospheric and subsurface factors \parencite{Turner2021}, but require more sophisticated computational capabilities to apply.


\subsection{Active-passive Sensor Fusion: The best of both worlds}
\cite{Parrish2019} conclude that the most effective way to use ICESat-2 data for bathymetric measurement is to combine it with optical/multispectral techniques. Because the lidar-derived data provides highly accurate point estimates along a linear track, and optical methods allow the estimation for a 2D area but require a priori depth data, combining the two techniques provides a synergistic fusion of the strengths of both. The lidar-derived depths are used as training data for the optical SDB models, creating a 2D picture of the bathymetry.

There have since been several studies that employ this approach, and evaluate different techniques for correcting refraction, finding bathymetric signal points, and combining the lidar data with optical techniques.

\subsection{Summary of Prior Research Combining Optical and Lidar SDB}

The studies that have used some version of the proposed technique are summarized in table \ref{tab:researchsummary}.

\newgeometry{bottom=20mm}
\begin{landscape}
      \begin{table}
            \caption{Summary of SDB research that combines spaceborne lidar and optical data}
            \label{tab:researchsummary}
            % \centering
            \raggedright
            \begin{tabular}{p{3.7cm}llp{3.2cm}p{3.5cm}ll}
                  \midrule
                  Paper                              & Year & Dataset & Refraction Correction Method  & S/N Classification method     & Tide Correction & Notes                        \\
                  \hline
                  \citeauthor{Forfinski-Sarkozi2016} & 2016 & MABEL   & First-order depth correction  & Manual                        & N/A             & non-tidal                    \\
                  \citeauthor{Parrish2019}           & 2019 & ATL03   & Parrish method                & Manual                        & N/A             & Compared ellipsoidal heights \\
                  \citeauthor{Ma2020}                & 2020 & ATL03   & Parrish + sloping sea surface & Adaptive DBSCAN               & OTPS2           & -                            \\
                  \citeauthor{Thomas2021d}           & 2020 & ATL03   & Parrish Method                & Manual                        & Not Specified   & -                            \\
                  \citeauthor{Albright2021}          & 2021 & ATL03   & First-order                   & Manual                        & N/A             & Converted to NAD83           \\
                  \citeauthor{Xie2021}               & 2021 & ATL03   & Parrish Method                & Adaptive DBSCAN               & Not specified   & DBSCAN is used iteratively   \\
                  \citeauthor{Cao2021}               & 2021 & ATL03   & First-order depth correction  & A-DRAGANN                     & OTPS2           & -                            \\
                  \citeauthor{Lee2021}               & 2021 & ATL03   & Not specified                 & Not specified                 & T\_TIDE         & -                            \\
                  \citeauthor{Liu2021}               & 2021 & ATL03   & Liu method                    & DBSCAN after Ma et al.        & TMD tidal model & -                            \\
                  \citeauthor{LeQuilleuc2022b}       & 2022 & ATL03   & Parrish                       & DBSCAN with manual correction & N/A             & Compared ellipsoidal heights \\
                  \bottomrule
            \end{tabular}
      \end{table}

\end{landscape}
\restoregeometry

\subsection{Bathymetric Data Assimilation}

% \subsubsection*{temp notes}
\begin{itemize}
      \color{blue}
      \item Ensemble Kalman Filter represents distributions by an ensemble, which is propagated using the temporal evolution model and updated via a linear shift based on new observations \parencite{Jurek2021}.
      \item When ignoring the temporal dimension, using the sparsity assumption with an ensemble kalman filter allows for faster computation \parencite{Jurek2021}
      \item The approach in \citeauthor{Jurek2021} seems better for if I need a temporal dimension 
      \item Data Assimilation is a an inverse modeling technique, that uses statistical optimization to find the most likely true value given the known uncertainties and correlations in uncertainties \parencite{Salim2021}
      \item Interpolation from discrete points induces 2 types of error, aliasing of subgrid features and measurement errors \parencite{Plant2002}
   
      \item  Extended Kalman filter from \parencite{Ghorbanidehno2019}
       \begin{itemize}
            \item The idea behind the extended kalman is you have unknowns in a state vector $x_{t+1} = f(x_t) + w_t$, where $f(...)$ is the forward transition model and $w_t$ is the model error or noise and is modeled as a multivariate gaussian random vector 
            \item Measurements in the system are defined as $y_t = h(x_{t+1}) + v_t$
            \item EKF gives the posterior mean ($X_{t+1 | t+1}$)
            \item EKF gives accurate results in the least-squares sense, but its not practical due to the amount of matrix multiplication of large matrices and the cost of computing jacobian matricies.
      \end{itemize}
      \item This EKF can be made more efficient using Compressed-state Kalman filter (Also from \parencite{Ghorbanidehno2019})
      \begin{itemize}
            \item use low-rank approximation to reduce amount of memory
            \item the covariance matrix can be approximated using data compression algorithms.
            \item To get the covariance matrix back from compression you do $P_t \approx A C_t A_T$ where A is a matrix defining a subspace of the original matrix that provides a good approximation (ie you project the state onto this subspace and its reasonably close to the actual state)

      \end{itemize}
\end{itemize}


\color{blue}
\begin{equation}
      \hat{z}_i = \sum_{j=1}^{J}{\hat{a}_{ij}} (\tilde{z}_j + {z'}_j+e_j)
\end{equation}
where $\tilde{z}_j = \text{true bathymetry}$, and ${z'}_j = \text{part of bathy unresolved due to horizontal resolution}$, and $e_j = \text{measurement error}$. This can be further split into noise and aliasing error. \parencite{Plant2002}
\color{black}